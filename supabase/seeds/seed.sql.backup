-- Import des données de test pour le CRM GMBS

-- Créer les utilisateurs gestionnaires avec codes et couleurs
INSERT INTO public.users (name, prenom, username, email, code_gestionnaire, color, created_at, updated_at) VALUES
('Olivier', 'Gestionnaire', 'olivier', 'olivier@gmbs.fr', 'O', '#A22116', NOW(), NOW()),
('Badr', 'Boujimal', 'badr', 'badr@gmbs.fr', 'B', '#D9ECC0', NOW(), NOW()),
('Admin', 'Système', 'admin', 'admin@gmbs.fr', 'ADMIN', '#FF0000', NOW(), NOW()),
('Andrea', 'GAUTRET', 'andrea', 'andrea@gmbs.fr', 'A', '#C5E0F4', NOW(), NOW()),
('Tom', 'Birckel', 'tom', 'tom@gmbs.fr', 'T', '#A22116', NOW(), NOW()),
('Paul', 'Aguenana', 'paul', 'paul@gmbs.fr', 'P', '#EBF551', NOW(), NOW()),
('Louis', 'Saune', 'louis', 'louis@gmbs.fr', 'J', '#69D9E5', NOW(), NOW()),
('Samuel', 's', 'samuel', 'samuel@gmbs.fr', 'S', '#543481', NOW(), NOW()),
('Lucien', 'L', 'lucien', 'lucien@gmbs.fr', 'L', '#35714E', NOW(), NOW()),
('Killian', 'K', 'killian', 'killian@gmbs.fr', 'K', '#1227A1', NOW(), NOW()),
('Dimitri', 'Montanari', 'dimitri', 'dimitri@gmbs.fr', 'D', '#FBE6A8', NOW(), NOW()),
('Soulaimane', 'Soulaimane', 'soulaimane', 'soulaimane@gmbs.fr', 'SO', '#FF6B6B', NOW(), NOW()),
('Clément', 'Clément', 'clement', 'clement@gmbs.fr', 'C', '#4ECDC4', NOW(), NOW())
ON CONFLICT (username) DO NOTHING;

-- Métiers (ajout des métiers manquants)
INSERT INTO public.metiers (code, label) VALUES
('PLOMBERIE', 'Plomberie'),
('BRICOLAGE', 'Bricolage'),
('PEINTURE', 'Peinture'),
('ELECTRICITE', 'Électricité'),
('SERRURERIE', 'Serrurerie'),
('MULTI_SERVICE', 'Multi-Service')
ON CONFLICT (code) DO NOTHING;

-- Artisans avec le bon mapping CSV (sans commentaire)
INSERT INTO public.artisans (
  nom_prenom, numero_associe, raison_sociale, siret, statut_juridique, 
  statut_artisan, statut_dossier, adresse_siege_social, ville_siege_social, 
  code_postal_siege_social, email, telephone, date_ajout, 
  suivi_relances_docs, created_at, updated_at
) VALUES
(
  'Adama Sy', '68', 'MABS', '90199093700012', 'AUTO ENTREPRENEUR',
  'POTENTIEL', 'DOSSIER À FINALISER', '6 rue DES MARECHAUX', 'MULHOUSE', '68100',
  'adama.thialy@gmail.com', '07 60 02 22 13', '30/06/2025', NULL,
  NOW(), NOW()
),
(
  'belhares mounir', '69', 'BM PLOMBERIE', '87873843400017', 'AUTO ENTREPRENEUR',
  'NOVICE', 'COMPLET', '8 C AVENUE PIERRE BROSSOLETTE', 'LYON', '69500',
  'mounir.belhares@gmail.com', '06 38 14 72 71', '10/2024', 'Mail relance doc envoyé',
  NOW(), NOW()
),
(
  'Abdel ajgaf', '34', 'SUD Multiservices', '89321105200020', 'EIRL',
  'NOVICE', 'INCOMPLET', '4103 BOULEVARD PAUL VALERY', 'MONTPELLIER', '34070',
  'sudmultiservicescontact@gmail.com', '06 28 56 36 25', '12/2024', NULL,
  NOW(), NOW()
),
(
  'Alexandru Barbaneagra', '67', NULL, '848072930', 'AUTO ENTREPRENEUR',
  'ONE SHOT', 'INCOMPLET', NULL, NULL, NULL,
  'alexodnok9230@gmail.com', '07 53 61 27 91', '9/2024', NULL,
  NOW(), NOW()
);

-- Associer les gestionnaires aux artisans
UPDATE public.artisans SET gestionnaire_id = (SELECT id FROM public.users WHERE username = 'olivier') WHERE nom_prenom = 'Adama Sy';
UPDATE public.artisans SET gestionnaire_id = (SELECT id FROM public.users WHERE username = 'badr') WHERE nom_prenom = 'belhares mounir';
UPDATE public.artisans SET gestionnaire_id = (SELECT id FROM public.users WHERE username = 'admin') WHERE nom_prenom = 'Abdel ajgaf';
UPDATE public.artisans SET gestionnaire_id = (SELECT id FROM public.users WHERE username = 'andrea') WHERE nom_prenom = 'Alexandru Barbaneagra';

-- Associer les artisans aux métiers
INSERT INTO public.artisan_metiers (artisan_id, metier_id) VALUES
((SELECT id FROM public.artisans WHERE nom_prenom = 'Adama Sy'), (SELECT id FROM public.metiers WHERE code = 'PLOMBERIE')),
((SELECT id FROM public.artisans WHERE nom_prenom = 'belhares mounir'), (SELECT id FROM public.metiers WHERE code = 'PLOMBERIE')),
((SELECT id FROM public.artisans WHERE nom_prenom = 'Abdel ajgaf'), (SELECT id FROM public.metiers WHERE code = 'MULTI_SERVICE')),
((SELECT id FROM public.artisans WHERE nom_prenom = 'Alexandru Barbaneagra'), (SELECT id FROM public.metiers WHERE code = 'MULTI_SERVICE'));

-- Interventions avec les vraies données du CSV (corrigé)
INSERT INTO public.interventions (
  id_inter, date, agence, adresse, code_postal, ville, statut, contexte_intervention, type,
  proprietaire, nom_prenom_client, telephone_client, telephone2_client, email_client,
  cout_sst, cout_materiel, cout_intervention,
  demande_intervention, demande_devis, date_demande_intervention, date_demande_devis,
  created_at, updated_at
) VALUES
(
  '5184', '2024-08-23T00:00:00Z', 'Oqoro', '13 Rue D''orbey Strasbourg- Et. 6', NULL, 'Strasbourg', 
  'Inter terminée', '16 Janvier 16H Réparer le placard dont les portes coulissantes ne souvrent pas', 'Bricolage',
  'OQORO', 'Sarah Riofrio', '+593939825448', '["+33658365120", "+59393941456"]', NULL,
  75, NULL, 115,
  '{"texte": "16-12-2024 17:00 - Demande d''intervention ✅ ''brouillon'' à: alexodnok9230@gmail.com avec gmbs.tom@gmail.com"}', NULL,
  '16-12-2024', NULL,
  NOW(), NOW()
),
(
  '5542', '2024-09-10T00:00:00Z', 'ImoDirect', '10 Rue Monge', '34070', 'MONTPELLIER', 
  'Inter terminée', 'Remplacement du barillet de la boîte aux lettres + 90 Diagnostic de panne et tentative de réparation sur Deux volets roulants dont 1 éléctriques ne fonctionnent plus Fuite mitigeur cuisine 75 Robinet wc à remplacer + 50', 'Bricolage',
  'MD002881', 'Madame ALQUIER Edina', '06 33 37 33 68', NULL, NULL,
  215, 66.51, 504.9,
  '{"texte": "18-12-2024 15:56 - Demande d''intervention ✅ ''brouillon'' à: sudmultiservicescontact@gmail.com avec davidl.gmbs@gmail.com"}', NULL,
  '18-12-2024', NULL,
  NOW(), NOW()
),
(
  '5592', '2024-09-17T00:00:00Z', 'Oqoro', '5 Place Saint-Antoine Strasbourg - Et. 5 - Ch 2', NULL, 'Strasbourg', 
  'Inter terminée', 'Num LOC OK TRASNMIS AU SST /// Remise en place de la poignée de porte dévissée.', 'Bricolage',
  'OQORO', 'Laetitia Ngomsu Kwekem', '+237675776317', NULL, NULL,
  75, NULL, 125,
  '{"texte": "16-12-2024 17:00 - Demande d''intervention ✅ ''brouillon'' à: alexodnok9230@gmail.com avec gmbs.tom@gmail.com"}', NULL,
  '16-12-2024', NULL,
  NOW(), NOW()
),
(
  '5690', '2024-09-19T00:00:00Z', 'Oqoro', '1 Rue Curie Strasbourg - Et. 2', NULL, 'Strasbourg', 
  'Stand by', 'LOC NRP /// Refixer prise cuisine', 'Bricolage',
  'OQORO', 'Michaël Tankam Bekou', '+237691591609', '["+33659244690", "+33744829204", "+33661909064", "+33656762239"]', NULL,
  90, NULL, 110,
  '{"texte": "16-12-2024 17:00 - Demande d''intervention ✅ ''brouillon'' à: alexodnok9230@gmail.com avec gmbs.tom@gmail.com"}', NULL,
  '16-12-2024', NULL,
  NOW(), NOW()
),
(
  NULL, '2024-10-07T00:00:00Z', 'Flatlooker', '819 Avenue Raymond Dugrand', NULL, 'Montpellier', 
  'Visite Technique', 'devis pour une fissure se trouvant sur le mur gauche du salon, et une remise en peinture suite à un ancien dégât des eaux', 'Peinture',
  NULL, 'Sarah Lefevre', '0615222801', NULL, NULL,
  NULL, NULL, NULL,
  NULL, '{"texte": "08-10-2024 15:06 - Demande de devis ✅ ''brouillon'' à: sudmultiservicescontact@gmail.com avec antoine.gmbs@gmail.com"}',
  NULL, '08-10-2024',
  NOW(), NOW()
),
(
  '6334', '2024-10-17T00:00:00Z', 'AFEDIM', 'BATIMENT C - 3eme - APT C31 VIVACITY 28 RUE DU BATAILLON DE MARCHE', '67200', 'STRASBOURG', 
  'Inter terminée', 'inter terminer à facturer //- - joint bac à douche - aimant du placard salle d''eau cassée. Charge prop : - joint lavabo salle d''eau - joint évier cuisine.', 'Bricolage',
  'MME LITZELMANN WEIL ALEXINA', 'MME CECILE KASSA', '652514455', NULL, NULL,
  150, NULL, 245,
  '{"texte": "09-01-2025 17:56 - Demande d''intervention ✅ ''brouillon'' à: alexodnok9230@gmail.com avec samuel.gmbs@gmail.com"}', NULL,
  '09-01-2025', NULL,
  NOW(), NOW()
),
(
  '6683', '2024-10-17T00:00:00Z', 'HomePilot', '26 rue de l''Imprimerie à Montpellier', NULL, 'Montpellier', 
  'Visite Technique', 'Les locataires ont subi un dégât des eaux. Le plafond de la salle de bain est endommagé (morceaux de placo se détachent et tombent). Pourriez-vous établir un devis de remise en état pour assurance', 'Peinture',
  NULL, 'Madame Meimoun', '0684684242', '["06 15 88 48 39"]', NULL,
  709, NULL, NULL,
  NULL, '{"texte": "24-10-2024 14:44 - Demande de devis ✅ ''brouillon'' à: sudmultiservicescontact@gmail.com avec antoine.gmbs@gmail.com"}',
  NULL, '24-10-2024',
  NOW(), NOW()
),
(
  '7096', '2024-11-25T00:00:00Z', 'Flatlooker', '221 Rue Des Yuccas', NULL, 'Montpellier', 
  'Annulé', 'devis complémentaire dispo mais pas facturable car rien n''a été fais fournir un devis pour la réparation des portes de la cabine de douche s''il vous plaît ? Les portes ne coulissent plus', 'Plomberie',
  'Stravos Alissandratos', 'Jade Ricard', '33769179374', NULL, NULL,
  60, NULL, 155,
  '{"texte": "17-12-2024 17:03 - Demande d''intervention ✅ ''brouillon'' à: sudmultiservicescontact@gmail.com avec gmbs.paul@gmail.com"}', NULL,
  '17-12-2024', NULL,
  NOW(), NOW()
),
(
  '7530', '2024-11-17T00:00:00Z', 'Flatlooker', '91 Avenue Francis de Pressensé', NULL, 'Vénissieux', 
  'Inter terminée', 'terminer// 29/01 débouchage d''un tuyau entre le lavabo et la douche , eau chaude débit très faible/ doit faire un detartrage du tuyaux', 'Plomberie',
  'francois ducrot', NULL, '07 71 81 14 32', '["749942419"]', NULL,
  80, NULL, 150,
  '{"texte": "19-12-2024 17:38 - Demande d''intervention ✅ ''brouillon'' à: mounir.belhares@gmail.com avec gmbs.paul@gmail.com"}', NULL,
  '19-12-2024', NULL,
  NOW(), NOW()
),
(
  '8396', '2024-11-17T00:00:00Z', 'Flatlooker', '91 Avenue Francis de Pressensé', NULL, 'Vénissieux', 
  'Annulé', 'Inter réalisé mais non concluante TERMINER 17 h devis supp 7530 / detartrage a pas marcher doit faire un devis pour remplacer les tuyau en PER', 'Plomberie',
  'francois ducrot', NULL, '07 71 81 14 32', '["749942419"]', NULL,
  250, NULL, 393.78,
  '{"texte": "07-02-2025 16:45 - Demande d''intervention ✅ ''brouillon'' à: mounir.belhares@gmail.com avec samuel.gmbs@gmail.com"}', NULL,
  '07-02-2025', NULL,
  NOW(), NOW()
),
(
  '9553', '2024-11-17T00:00:00Z', 'Flatlooker', '91 Avenue Francis de Pressensé', NULL, 'Vénissieux', 
  'Devis Envoyé', 'Devis qui remplace le devis 8396 car l''intervention n''a pas été concluante / 06 74 53 17 81 / interveneir de l''autre coté du mur pour eviter cassage carrelage. rappelle au plus vite propriétaire', 'Plomberie',
  'francois ducrot', NULL, '07 71 81 14 32', '["749942419"]', NULL,
  250, NULL, 986.27,
  NULL, NULL,
  NULL, NULL,
  NOW(), NOW()
),
(
  '8083', '2025-01-17T00:00:00Z', 'Oqoro', '114 Rue Guillaume Janvier Montpellier - Et. 5', NULL, 'Montpellier', 
  'Inter terminée', 'ATT PHOTO ET BAIE PAS REPARE + TROU LOQUET PAS REBOUCHE 19mars Réparer loquet porte-fenêtre du salon Placer un nouveau verrou sur la porte coulissante de salle de bain Refixer prise de chambre 1', 'Bricolage',
  NULL, 'Sai Karthik Reddy Gade', '+33745539503', '["+918168892502"]', NULL,
  90, NULL, 180,
  '{"texte": "14-03-2025 13:49 - Demande d''intervention ✅ ''brouillon'' à: sudmultiservicescontact@gmail.com avec lucien.gmbs@gmail.com"}', '{"texte": "13-02-2025 17:32 - Demande de devis ✅ ''brouillon'' à: azd34070@gmail.com avec lucien.gmbs@gmail.com"}',
  '14-03-2025', '13-02-2025',
  NOW(), NOW()
),
(
  '9338', '2025-01-17T00:00:00Z', 'Oqoro', '114 Rue Guillaume Janvier Montpellier - Et. 5', NULL, 'Montpellier', 
  'Devis Envoyé', 'Devis supp (8083) baie vitrée : remp serrure 2 gaches', 'Bricolage',
  NULL, 'Sai Karthik Reddy Gade', '+33745539503', '["+918168892502"]', NULL,
  250, NULL, 350,
  NULL, NULL,
  NULL, NULL,
  NOW(), NOW()
),
(
  '8057', '2025-01-24T00:00:00Z', 'Flatlooker', '221 Rue Des Yuccas', NULL, 'Montpellier', 
  'Inter terminée', 'lterminer accompte ok 327,90€ le 5/02/ sst att réception matériel avant prise de rdv //devis supp 7096 : remplacement des portes de douche qui ne sont pas réparables ac+cpt kyks', 'Plomberie',
  NULL, NULL, NULL, NULL, NULL,
  615, NULL, 745.21,
  '{"texte": "30-01-2025 13:58 - Demande d''intervention ✅ ''brouillon'' à: sudmultiservicescontact@gmail.com avec samuel.gmbs@gmail.com"}', NULL,
  '30-01-2025', NULL,
  NOW(), NOW()
),
(
  '8314', '2025-01-29T00:00:00Z', 'Flatlooker', '20 Rue Moncey', NULL, 'Lyon', 
  'Inter terminée', 'terminer // Bonjour, Pourriez-vous me faire parvenir un devis pour : - Traces de moisissures sur meuble sous vasque - Porte de douche cassée - Bonde de douche usée Je vous remercie et reste à votre disposition, Cordialement,', 'Plomberie',
  NULL, NULL, NULL, NULL, NULL,
  150, NULL, 249,
  '{"texte": "07-02-2025 13:28 - Demande d''intervention ✅ ''brouillon'' à: mounir.belhares@gmail.com avec samuel.gmbs@gmail.com"}', NULL,
  '07-02-2025', NULL,
  NOW(), NOW()
),
(
  '8947', '2025-01-29T00:00:00Z', 'Flatlooker', '20 Rue Moncey', NULL, 'Lyon', 
  'Devis Envoyé', 'devis supp 8314 cabine de douche', 'Plomberie',
  NULL, NULL, NULL, NULL, NULL,
  150, NULL, 249,
  '{"texte": "07-02-2025 13:28 - Demande d''intervention ✅ ''brouillon'' à: mounir.belhares@gmail.com avec samuel.gmbs@gmail.com"}', NULL,
  '07-02-2025', NULL,
  NOW(), NOW()
),
(
  '8246', '2025-01-31T00:00:00Z', 'Flatlooker', '16 Rue D''alger', NULL, 'Montpellier', 
  'Inter terminée', '20 fevrier // barillet boite aux lettre', 'Serrurerie',
  NULL, 'nouveau locataire', '0771412078', NULL, 'gabrielf.gmbs@gmail.com',
  80, NULL, NULL,
  '{"texte": "05-02-2025 13:30 - Demande d''intervention ✅ ''brouillon'' à: sudmultiservicescontact@gmail.com avec gabrielf.gmbs@gmail.com"}', NULL,
  '05-02-2025', NULL,
  NOW(), NOW()
),
(
  '12270', '2025-05-27T00:00:00Z', 'Oqoro', '37 Avenue Aristide Briand Mulhouse - Et. 4', NULL, 'Mulhouse', 
  'Devis Envoyé', 'Changement de bac de douche suite au développement de fissures : dégât des eaux', 'Plomberie',
  NULL, NULL, NULL, NULL, NULL,
  NULL, NULL, NULL,
  NULL, NULL,
  NULL, NULL,
  NOW(), NOW()
),
(
  NULL, '2025-06-20T00:00:00Z', 'AFEDIM', 'BATIMENT ALMALEGGO 48 QUAI DE L''ALMA', '68100', 'MULHOUSE', 
  'Visite Technique', 'une légère fuite au niveau du raccordement ou du joint d''étanchéité des wc', 'Plomberie',
  'M KOPP CHRISTIAN', 'M HALIM BIROUK', '06 72 48 47 38', NULL, NULL,
  NULL, NULL, NULL,
  NULL, '{"texte": "02-07-2025 15:43 - Demande de devis ✅ ''brouillon'' à: adama.thialy@gmail.com avec davidl.gmbs@gmail.com"}',
  NULL, '02-07-2025',
  NOW(), NOW()
),
(
  '11436', '2025-06-27T00:00:00Z', 'AFEDIM', 'BAT B - 1ER - APT B11 CARPE DIEM - BAT B - 1ER - APT B11 5 rue des Blés', '68200', 'MULHOUSE', 
  'Inter terminée', 'Diag réaliser// Changemenr de pile 03/07 ATT PHOTO // sifflement dans la vmc des toilettes', 'Electricite',
  'M VONAU ANTHONY MME SAVOLDELLI LAURA', 'MME MELISSA SILBERNAGEL', '+33 766099160', NULL, NULL,
  75, NULL, 150,
  '{"texte": "01-07-2025 10:25 - Demande d''intervention ✅ ''brouillon'' à: adama.thialy@gmail.com avec olivier.gmbs@gmail.com"}', NULL,
  '01-07-2025', NULL,
  NOW(), NOW()
);

-- Associer les gestionnaires aux interventions (mapping des lettres)
UPDATE public.interventions SET attribue_a = (SELECT id FROM public.users WHERE username = 'tom') WHERE id_inter IN ('5184', '5592', '5690');
UPDATE public.interventions SET attribue_a = (SELECT id FROM public.users WHERE username = 'andrea') WHERE id_inter IN ('5542');
UPDATE public.interventions SET attribue_a = (SELECT id FROM public.users WHERE username = 'dimitri') WHERE id_inter IN ('6683');
UPDATE public.interventions SET attribue_a = (SELECT id FROM public.users WHERE username = 'samuel') WHERE id_inter IN ('6334', '8396', '8057', '8314', '8947');
UPDATE public.interventions SET attribue_a = (SELECT id FROM public.users WHERE username = 'paul') WHERE id_inter IN ('7096', '7530', '9553');
UPDATE public.interventions SET attribue_a = (SELECT id FROM public.users WHERE username = 'lucien') WHERE id_inter IN ('8083', '9338');
UPDATE public.interventions SET attribue_a = (SELECT id FROM public.users WHERE username = 'badr') WHERE id_inter IN ('8246');
UPDATE public.interventions SET attribue_a = (SELECT id FROM public.users WHERE username = 'olivier') WHERE id_inter IN ('11436');
